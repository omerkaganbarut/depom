// main.cpp - PEEK VERSION (DÃœZELTILMIÅ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃœZELTÄ°LEN HATALAR:
//   âœ… bigEnc.reset() kullanÄ±ldÄ± (setPosition deÄŸil)
//   âœ… a0FiltreliOku() kullanÄ±ldÄ± (a0FiltreOku deÄŸil)
//   âœ… OPKON_PIN kullanÄ±ldÄ± (A0_PIN deÄŸil)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#include "MoveSalinim.h" 
#include <Arduino.h>
#include "Config.h"
#include "PulseAt.h"
#include "MoveTo.h"
#include "stepmotorenkoderiokuma.h"
#include "A0Filtre.h"
#include "KayitModulu.h"
#include "OynatmaModulu.h"
#include "CiftKayitModulu.h"
#include "CiftOynatmaModulu.h"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENCODER NESNELERÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
StepMotorEncoder zEnc(ENC2_A_PIN, ENC2_B_PIN);
StepMotorEncoder xEnc(ENC1_A_PIN, ENC1_B_PIN);
StepMotorEncoder bigEnc(ENC3_A_PIN, ENC3_B_PIN);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÄ°NAMÄ°K PARAMETRELER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
static long bigFreqMin = 10;
static long bigFreqMax = 100;
static long zEncMin = 0;
static long zEncMax = 20000;
static long bigFreqRef = 30;  // âœ… YENÄ° EKLENEN (eski BIG_FREQ_REF_HZ)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‡Ä°FT KAYIT/OYNATMA X POZÄ°SYONLARI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
static long x1Pos = 0;
static long x2Pos = -10000;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KOMUT BUFFER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
static char cmdBuffer[64];
static uint8_t cmdIndex = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FONKSÄ°YON PROTOTIPLERI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void yazdirMenu();
void handleCommand(const char* cmd);
void handleEncoderOku();
void handleA0Oku();
void handleCiftKayit();
void handleCiftOynatma();
void handleReset(char motor);
void handleX1Ayarla(const char* cmd);
void handleX2Ayarla(const char* cmd);
void handleXShow();
void handleBigRefAyarla(const char* cmd);
void handleBigRefShow();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void setup() {
  Serial.begin(115200);
  delay(500);
  
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘      DEPO KAYNAÄI SÄ°STEMÄ° BAÅLATILIYOR        â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));
  
  Serial.println(F("[1/5] Encoder'lar baÅŸlatÄ±lÄ±yor..."));
  zEnc.begin();
  xEnc.begin();
  bigEnc.begin();
  Serial.println(F("âœ“ Z, X, BIG encoder'lar hazÄ±r!\n"));
  
  Serial.println(F("[2/5] MoveTo modÃ¼lÃ¼ ayarlanÄ±yor..."));
  moveToSetup(&zEnc, &xEnc, &bigEnc);
  Serial.println(F("âœ“ MoveTo hazÄ±r!\n"));
  
  Serial.println(F("[3/5] KayÄ±t modÃ¼lÃ¼ ayarlanÄ±yor..."));
  kayitEncoderSetup(&bigEnc);
  Serial.println(F("âœ“ KayÄ±t modÃ¼lÃ¼ hazÄ±r!\n"));
  
  Serial.println(F("[4/5] Oynatma modÃ¼lÃ¼ ayarlanÄ±yor..."));
  oynatmaEncoderSetup(&bigEnc, &zEnc);
  oynatmaParametreSetup(&bigFreqMin, &bigFreqMax, &zEncMin, &zEncMax);
  oynatmaRefHizSetup(&bigFreqRef);  // âœ… YENÄ° EKLE
  Serial.println(F("âœ“ Oynatma modÃ¼lÃ¼ hazÄ±r!\n"));
  
  Serial.println(F("[5/5] Ã‡ift KayÄ±t/Oynatma modÃ¼lleri ayarlanÄ±yor..."));
  ckEncoderSetup(&bigEnc, &xEnc);
  coEncoderSetup(&bigEnc, &xEnc, &zEnc);
  coParametreSetup(&bigFreqMin, &bigFreqMax, &zEncMin, &zEncMax);
  Serial.println(F("âœ“ Ã‡ift modÃ¼ller hazÄ±r!\n"));

  // âœ… YENÄ°: MoveSalinim encoder setup
  msEncoderSetup(&xEnc);
  
  Serial.println(F("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘            SÄ°STEM HAZIR! ğŸš€                    â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));
  pinMode(KAYNAK_ROLE_PIN, OUTPUT);
  digitalWrite(KAYNAK_ROLE_PIN, HIGH); // NORMALDE AÃ‡IK
  yazdirMenu();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void loop() {
  moveToRun();
  kayitRun();
  oynatmaRun();
  ckRun();
  coRun();

  // âœ… YENÄ°: SalÄ±nÄ±m dÃ¶ngÃ¼sÃ¼ (sadece TEK oynatma ile Ã§alÄ±ÅŸÄ±r)
  if (oynatmaAktifMi() && !ckAktifMi()) {  // GÃ¼venlik kontrolÃ¼
    msRun();
  }
  
  // Oynatma bitince salÄ±nÄ±mÄ± durdur
  if (oynatmaTamamlandiMi() && msAktifMi()) {
    msDurdur();
    Serial.println("Oynatma bitti, salinim durduruldu!");
  }
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SERIAL OKUMA (Her zaman Ã§alÄ±ÅŸÄ±yor - blocking YOK!)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  while (Serial.available() > 0) {
    char c = Serial.read();
    
    if (c == '\n' || c == '\r') {
      if (cmdIndex > 0) {
        cmdBuffer[cmdIndex] = '\0';
        handleCommand(cmdBuffer);
        cmdIndex = 0;
      }
    }
    else if (cmdIndex < sizeof(cmdBuffer) - 1) {
      cmdBuffer[cmdIndex++] = c;
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KOMUT Ä°ÅLEYÄ°CÄ°SÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleCommand(const char* cmd) {
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [RST] RESET KOMUTU: RSTZ/RSTX/RSTB
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if ((cmd[0] == 'R' || cmd[0] == 'r') &&
      (cmd[1] == 'S' || cmd[1] == 's') &&
      (cmd[2] == 'T' || cmd[2] == 't')) {
    char motor = cmd[3];
    handleReset(motor);
    return;
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// [BR] BIG REFERANS HIZ AYARLA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [BR] BIG REFERANS HIZ AYARLA
  else if ((cmd[0] == 'B' || cmd[0] == 'b') && 
         (cmd[1] == 'R' || cmd[1] == 'r')) {
  // EÄŸer sadece "BR" ise gÃ¶ster, deÄŸilse ayarla.
    if (cmd[2] == '\0') {
     handleBigRefShow();  // "BR" â†’ GÃ¶ster
   } else {
      handleBigRefAyarla(cmd);  // "BR 50" veya "BR50" â†’ Ayarla
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [M] MOVETO: MZ/MX/MB hedef hz
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (cmd[0] == 'M' || cmd[0] == 'm') {
    char motor = cmd[1];
    uint8_t motorIndex;
    
    if (motor == 'Z' || motor == 'z') motorIndex = MOTOR_Z;
    else if (motor == 'X' || motor == 'x') motorIndex = MOTOR_X;
    else if (motor == 'B' || motor == 'b') motorIndex = MOTOR_B;
    else {
      Serial.println(F("âœ— GeÃ§ersiz motor! (MZ/MX/MB)"));
      return;
    }
    
    long hedef;
    unsigned int hz;
    
    if (sscanf(cmd + 2, "%ld %u", &hedef, &hz) == 2) {
      if (hz == 0) {
        Serial.println(F("âœ— Hz 0 olamaz!"));
        return;
      }
      
      Serial.print(F("[M"));
      Serial.print(motor);
      Serial.print(F("] "));
      Serial.print(hedef);
      Serial.print(F(" @ "));
      Serial.print(hz);
      Serial.print(F("Hz â†’ "));
      
      if (moveTo(motorIndex, hedef, hz)) {
        Serial.println(F("âœ“"));
      } else {
        Serial.println(F("âœ— (Aktif)"));
      }
    } else {
      Serial.println(F("âœ— Format: MZ hedef hz"));
    }
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [D] DURDUR: DZ/DX/DB
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (cmd[0] == 'D' || cmd[0] == 'd') {
    char motor = cmd[1];
    uint8_t motorIndex;
    
    if (motor == 'Z' || motor == 'z') motorIndex = MOTOR_Z;
    else if (motor == 'X' || motor == 'x') motorIndex = MOTOR_X;
    else if (motor == 'B' || motor == 'b') motorIndex = MOTOR_B;
    else {
      Serial.println(F("âœ— GeÃ§ersiz motor! (DZ/DX/DB)"));
      return;
    }
    
    pulseAtDurdur(motorIndex);
    moveToDurdur(motorIndex);
    
    Serial.print(F("[D"));
    Serial.print(motor);
    Serial.println(F("] âœ“ Durdu"));
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [S] ACÄ°L DURDURMA
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'S' || cmd[0] == 's') && (cmd[1] == '\0')) {
    Serial.println(F("\nâš ï¸  ACÄ°L DURDURMA!"));
    pulseAtHepsiniDurdur();
    moveToHepsiniDurdur();
    kayitDurdur();
    oynatmaDurdur();
    ckDurdur();
    coDurdur();
    msDurdur();
    digitalWrite(KAYNAK_ROLE_PIN,HIGH); // KAPALIYA AL
    Serial.println(F("âœ“ TÃ¼m sistemler durduruldu!\n"));
  }

  else if ((cmd[0] == 'S' || cmd[0] == 's') && (cmd[1] == 'M' || cmd[1] == 'm')) {
    Serial.println(F("\nâš ï¸  ACÄ°L MOTOR DURDURMA!"));
    pulseAtHepsiniDurdur();
    moveToHepsiniDurdur();
    Serial.println(F("âœ“ TÃ¼m motorlar durduruldu!\n"));
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [E] ENCODER OKU
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (cmd[0] == 'E' || cmd[0] == 'e') {
    handleEncoderOku();
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (strcmp(cmd, "KL") == 0) {
    Serial.println(F("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
    Serial.println(F("  KAYIT1 VERÄ°LERÄ°"));
    Serial.println(F("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
    ckKayit1Listele();
      
    Serial.println(F("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
    Serial.println(F("  KAYIT2 VERÄ°LERÄ°"));
    Serial.println(F("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
    ckKayit2Listele();
      
    Serial.print(F("\nGlobal A0 Min: "));
    Serial.println(globalA0Min);
    Serial.print(F("Global A0 Max: "));
    Serial.println(globalA0Max);
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [A] A0 SENSÃ–R
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (cmd[0] == 'A' || cmd[0] == 'a') {
    handleA0Oku();
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (strcmp(cmd, "K") == 0) {
    digitalWrite(KAYNAK_ROLE_PIN, !digitalRead(KAYNAK_ROLE_PIN));
    Serial.println(F("[KAYNAK] Toggle"));
 }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [H] HELP/MENU
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if (cmd[0] == 'H' || cmd[0] == 'h') {
    yazdirMenu();
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [CK] Ã‡Ä°FT KAYIT
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'C' || cmd[0] == 'c') && 
           (cmd[1] == 'K' || cmd[1] == 'k')) {
    handleCiftKayit();
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [CO] Ã‡Ä°FT OYNATMA
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'C' || cmd[0] == 'c') && 
           (cmd[1] == 'O' || cmd[1] == 'o')) {
    handleCiftOynatma();
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [X1] X1 POZÄ°SYON AYARLA
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'X' || cmd[0] == 'x') && 
           (cmd[1] == '1')) {
    handleX1Ayarla(cmd);
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [X2] X2 POZÄ°SYON AYARLA
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'X' || cmd[0] == 'x') && 
           (cmd[1] == '2')) {
    handleX2Ayarla(cmd);
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // [X SHOW] X POZÄ°SYONLARI GÃ–STER
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else if ((cmd[0] == 'X' || cmd[0] == 'x') && 
           (cmd[1] == ' ' || cmd[1] == '\0')) {
    handleXShow();
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // BÄ°LÄ°NMEYEN KOMUT
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  else {
    Serial.print(F("âœ— Bilinmeyen komut: "));
    Serial.println(cmd);
    Serial.println(F("  'H' yazÄ±n menÃ¼yÃ¼ gÃ¶rmek iÃ§in."));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENCODER OKU
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleEncoderOku() {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘              ENCODER POZÄ°SYONLARI              â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.print(F("  Z (ENC2): "));
  Serial.println(zEnc.getPosition());
  
  Serial.print(F("  X (ENC1): "));
  Serial.println(xEnc.getPosition());
  
  Serial.print(F("  BIG (ENC3): "));
  Serial.println(bigEnc.getPosition());
  
  Serial.println();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// A0 SENSÃ–R OKU (DÃœZELTILDI)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleA0Oku() {
  // âœ… DÃœZELTME: a0FiltreliOku() kullan (a0FiltreOku deÄŸil)
  uint16_t filtrelenmis = a0FiltreliOku();
  
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘                A0 SENSÃ–R                       â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.print(F("  Filtreli : "));
  Serial.println(filtrelenmis);
  
  Serial.println();
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BIG REFERANS HIZ AYARLAMA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleBigRefAyarla(const char* cmd) {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘        BIG REFERANS HIZ AYARLAMA               â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));

  // cmd baÅŸlangÄ±cÄ±: "BR..." -> argÃ¼manÄ± BR'den sonraki kÄ±sÄ±mdan al, boÅŸluklarÄ± at
  const char* arg = cmd + 2; // BR'den hemen sonra
  while (*arg == ' ' || *arg == '\t') arg++; // boÅŸluklarÄ± at

  long yeniDeger;
  if (sscanf(arg, "%ld", &yeniDeger) == 1) {
    if (yeniDeger < 10 || yeniDeger > 500) {
      Serial.println(F("âœ— DeÄŸer 10-500 arasÄ±nda olmalÄ±!"));
      Serial.println();
      return;
    }

    bigFreqRef = yeniDeger;

    Serial.println(F("âœ“ Referans hÄ±z gÃ¼ncellendi!"));
    Serial.print(F("  bigFreqRef = "));
    Serial.print(bigFreqRef);
    Serial.println(F(" Hz"));
  } else {
    Serial.println(F("âœ— GeÃ§ersiz format!"));
    Serial.println(F("  KullanÄ±m: BR 50 veya BR50"));
  }

  Serial.println();
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BIG REFERANS HIZ GÃ–STER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleBigRefShow() {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘         BIG REFERANS HIZ AYARI                 â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.print(F("  bigFreqRef: "));
  Serial.print(bigFreqRef);
  Serial.println(F(" Hz"));
  
  Serial.println(F("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"));
  Serial.println(F("  Not: Depo kenarÄ±ndaki (globalA0Min) hÄ±zdÄ±r."));
  Serial.println(F("       Ä°Ã§e doÄŸru gidildikÃ§e hÄ±z otomatik artar."));
  
  Serial.println();
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‡Ä°FT KAYIT BAÅLAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleCiftKayit() {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘             Ã‡Ä°FT KAYIT BAÅLATMA                â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.println(F("\nMevcut X PozisyonlarÄ±:"));
  Serial.print(F("  x1Pos = "));
  Serial.println(x1Pos);
  Serial.print(F("  x2Pos = "));
  Serial.println(x2Pos);
  Serial.println(F("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"));
  
  // Direkt baÅŸlat!
  ckBaslat(x1Pos, x2Pos, 0, 1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‡Ä°FT OYNATMA BAÅLAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleCiftOynatma() {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘            Ã‡Ä°FT OYNATMA BAÅLATMA               â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.println(F("\nMevcut Parametreler:"));
  Serial.print(F("  x1Pos     = "));
  Serial.println(x1Pos);
  Serial.print(F("  x2Pos     = "));
  Serial.println(x2Pos);
  Serial.print(F("  BigFreqMin= "));
  Serial.println(bigFreqMin);
  Serial.print(F("  BigFreqMax= "));
  Serial.println(bigFreqMax);
  Serial.print(F("  zEncMin   = "));
  Serial.println(zEncMin);
  Serial.print(F("  zEncMax   = "));
  Serial.println(zEncMax);
  Serial.println(F("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"));
  
  // Direkt baÅŸlat!
  coBaslat(x1Pos, x2Pos);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET (ENCODER SIFIRLAMA) - DÃœZELTILDI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleReset(char motor) {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘            ENCODER SIFIRLAMA                   â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));
  
  if (motor == 'Z' || motor == 'z') {
    long onceki = zEnc.getPosition();
    // âœ… DÃœZELTME: reset() kullan (setPosition deÄŸil)
    zEnc.reset();
    
    Serial.print(F("  Z Encoder sÄ±fÄ±rlandÄ±! (Ã–nceki: "));
    Serial.print(onceki);
    Serial.println(F(")"));
  }
  else if (motor == 'X' || motor == 'x') {
    long onceki = xEnc.getPosition();
    // âœ… DÃœZELTME: reset() kullan (setPosition deÄŸil)
    xEnc.reset();
    
    Serial.print(F("  X Encoder sÄ±fÄ±rlandÄ±! (Ã–nceki: "));
    Serial.print(onceki);
    Serial.println(F(")"));
  }
  else if (motor == 'B' || motor == 'b') {
    long onceki = bigEnc.getPosition();
    // âœ… DÃœZELTME: reset() kullan (setPosition deÄŸil)
    bigEnc.reset();
    
    Serial.print(F("  BIG Encoder sÄ±fÄ±rlandÄ±! (Ã–nceki: "));
    Serial.print(onceki);
    Serial.println(F(")"));
  }
  else {
    Serial.println(F("âœ— GeÃ§ersiz motor! (Z/X/B)"));
  }
  
  Serial.println();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// X1 POZÄ°SYON AYARLAMA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleX1Ayarla(const char* cmd) {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘           X1 POZÄ°SYON AYARLAMA                 â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));
  
  // [DURUM 1] "X1 SET" â†’ Mevcut encoder'Ä± al
  if (strstr(cmd, "SET") != nullptr || strstr(cmd, "set") != nullptr) {
    x1Pos = xEnc.getPosition();
    
    Serial.println(F("âœ“ X1 pozisyonu gÃ¼ncellendi!"));
    Serial.print(F("  x1Pos = "));
    Serial.println(x1Pos);
  }
  // [DURUM 2] "X1 5000" â†’ Manuel deÄŸer
  else {
    long yeniDeger;
    if (sscanf(cmd + 3, "%ld", &yeniDeger) == 1) {
      x1Pos = yeniDeger;
      
      Serial.println(F("âœ“ X1 pozisyonu gÃ¼ncellendi!"));
      Serial.print(F("  x1Pos = "));
      Serial.println(x1Pos);
    }
    else {
      Serial.println(F("âœ— GeÃ§ersiz format!"));
      Serial.println(F("  KullanÄ±m: X1 SET  veya  X1 5000"));
    }
  }
  
  Serial.println();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// X2 POZÄ°SYON AYARLAMA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleX2Ayarla(const char* cmd) {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘           X2 POZÄ°SYON AYARLAMA                 â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"));
  
  // [DURUM 1] "X2 SET" â†’ Mevcut encoder'Ä± al
  if (strstr(cmd, "SET") != nullptr || strstr(cmd, "set") != nullptr) {
    x2Pos = xEnc.getPosition();
    
    Serial.println(F("âœ“ X2 pozisyonu gÃ¼ncellendi!"));
    Serial.print(F("  x2Pos = "));
    Serial.println(x2Pos);
  }
  // [DURUM 2] "X2 12000" â†’ Manuel deÄŸer
  else {
    long yeniDeger;
    if (sscanf(cmd + 3, "%ld", &yeniDeger) == 1) {
      x2Pos = yeniDeger;
      
      Serial.println(F("âœ“ X2 pozisyonu gÃ¼ncellendi!"));
      Serial.print(F("  x2Pos = "));
      Serial.println(x2Pos);
    }
    else {
      Serial.println(F("âœ— GeÃ§ersiz format!"));
      Serial.println(F("  KullanÄ±m: X2 SET  veya  X2 12000"));
    }
  }
  
  Serial.println();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// X POZÄ°SYONLARI GÃ–STER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void handleXShow() {
  Serial.println(F("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘          X POZÄ°SYON AYARLARI                   â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  
  Serial.print(F("  x1Pos (KayÄ±t1): "));
  Serial.println(x1Pos);
  
  Serial.print(F("  x2Pos (KayÄ±t2): "));
  Serial.println(x2Pos);
  
  Serial.println(F("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"));
  Serial.print(F("  Mevcut X encoder: "));
  Serial.println(xEnc.getPosition());
  
  Serial.println();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MENÃœ YAZDIR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void yazdirMenu() {
  Serial.println(F("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"));
  Serial.println(F("â•‘                ANA MENÃœ                        â•‘"));
  Serial.println(F("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"));
  Serial.println(F("  MZ/MX/MB <hedef> <hz> â†’ Motor hareket"));
  Serial.println(F("  KL                    â†’ KayÄ±t1 & KayÄ±t2 listele"));
  Serial.println(F("  K                     â†’ Kaynak rÃ¶le toggle (Pin 14)"));
  Serial.println(F("  DZ/DX/DB              â†’ Motor durdur"));
  Serial.println(F("  S                     â†’ Acil durdur"));
  Serial.println(F("  SM                    â†’ MOTORLARI ACÄ°L DURDUR"));
  Serial.println(F("  E                     â†’ Encoder oku"));
  Serial.println(F("  A                     â†’ A0 sensÃ¶r oku"));
  Serial.println(F("  RSTZ/RSTX/RSTB        â†’ Encoder sÄ±fÄ±rla"));
  Serial.println(F("  X1 SET / X1 <deÄŸer>   â†’ X1 pozisyon ayarla"));
  Serial.println(F("  X2 SET / X2 <deÄŸer>   â†’ X2 pozisyon ayarla"));
  Serial.println(F("  X                     â†’ X pozisyonlarÄ±nÄ± gÃ¶ster"));
  Serial.println(F("  CK                    â†’ Ã‡ift kayÄ±t baÅŸlat"));
  Serial.println(F("  CO                    â†’ Ã‡ift oynatma baÅŸlat"));
  Serial.println(F("  BR <deÄŸer> / BR       â†’ Big referans hÄ±z ayarla/gÃ¶ster"));
  Serial.println(F("  H                     â†’ MenÃ¼"));
  Serial.println(F("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"));
}
